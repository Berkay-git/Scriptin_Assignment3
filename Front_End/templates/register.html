{% extends 'base.html' %}

{% block header %}
<h1 style="color: rebeccapurple; margin-left: 15px;">{% block title %}Register{% endblock %}</h1> <!--comment-->
{% endblock %}

{% block content %}

<script>
    function countDigits(pwd){
        var i;
        var counter = 0;
        for(i=0; i<pwd.length; i++){
            if("0123456789".search(pwd[i])!= -1)
            counter++;
        }
        return counter;
    }

    function validate(){
        var pass = document.forms["registerform"]["password"].value;
        var error =""

        if(pass.search(/[a-z]/) == -1)  // it will return -1 if there is no lowercase letter
            error += "The password must contain at least one lowercase letter!\n";

        if(pass.search(/[A-Z]/) == -1)  // it will return -1 if there is no uppercase letter
            error += "The password must contain at least one uppercase letter!\n";

        if(countDigits(pass)<1)
            error += "The password must contain at least one digit!\n";

        if(pass.length < 10)
            error += "The password must contain at least 10 characters!\n";

        if(error.length == 0)
            return true;
        else{
            alert(error);
            return false;
        }
    }

</script>

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script>
        function checkUsername(str){
            var xhttp = new XMLHttpRequest(); //AJAX here works without needing user to refresh the page.
            xhttp.onreadystatechange = function(){  // when state changes, function works
                if(this.readyState == 4 && this.status == 200){ //readyState == 4 means request and 200 is success
                    document.getElementById("error").innerHTML = this.responseText; // is the response we send back.
                }
            };
            xhttp.open("GET", "/checkusername/" + str, true); // with this, ajax works async.
            xhttp.send();
        }
    </script>
</head>



<form method="POST" action="/register" class="styled-table" onsubmit="return validate()" name="registerform">
  <label>Username: </label>
      <input type="text" name="username" required onfocusout="checkUsername(this.value)" /><span id="error"></span><br/>
      <!--onfocusout will work when another text box is selected in front end-->
    </br>
  <label>Password: </label>
  <input type="password" name="password" required/><br/>
    </br>
  <label>Fullname: </label>
  <input type="text" name="name" required/><br/>
    </br>
  <label>e-mail: </label>
  <input type="text" name="email" required/><br/>
    </br>
  <input type="submit" value="Register" style="margin-left: 198px" />

</form>

{% endblock %}